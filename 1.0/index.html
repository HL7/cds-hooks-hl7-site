



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>1.0 - CDS Hooks</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#757575">
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="grey" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cds-services" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="CDS Hooks" class="md-header-nav__button md-logo">
          
            <img src="../images/logo-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              CDS Hooks
            </span>
            <span class="md-header-nav__topic">
              1.0
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/hl7/cds-hooks-hl7-site/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="CDS Hooks" class="md-nav__button md-logo">
      
        <img src="../images/logo-square.png" width="48" height="48">
      
    </a>
    CDS Hooks
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/hl7/cds-hooks-hl7-site/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Releases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        1.0
      </label>
    
    <a href="./" title="1.0" class="md-nav__link md-nav__link--active">
      1.0
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conformance-language" title="Conformance Language" class="md-nav__link">
    Conformance Language
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-hooks-anatomy" title="CDS Hooks Anatomy" class="md-nav__link">
    CDS Hooks Anatomy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discovery" title="Discovery" class="md-nav__link">
    Discovery
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-status-codes" title="HTTP Status Codes" class="md-nav__link">
    HTTP Status Codes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery-example" title="Discovery Example" class="md-nav__link">
    Discovery Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-a-cds-service" title="Calling a CDS Service" class="md-nav__link">
    Calling a CDS Service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request_1" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookinstance" title="hookInstance" class="md-nav__link">
    hookInstance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#providing-fhir-resources-to-a-cds-service" title="Providing FHIR Resources to a CDS Service" class="md-nav__link">
    Providing FHIR Resources to a CDS Service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefetch-template" title="Prefetch Template" class="md-nav__link">
    Prefetch Template
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefetch-tokens" title="Prefetch tokens" class="md-nav__link">
    Prefetch tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefetch-query-restrictions" title="Prefetch query restrictions" class="md-nav__link">
    Prefetch query restrictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-token" title="Example prefetch token" class="md-nav__link">
    Example prefetch token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-templates" title="Example prefetch templates" class="md-nav__link">
    Example prefetch templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-data" title="Example prefetch data" class="md-nav__link">
    Example prefetch data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fhir-resource-access" title="FHIR Resource Access" class="md-nav__link">
    FHIR Resource Access
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passing-the-access-token-to-the-cds-service" title="Passing the Access Token to the CDS Service" class="md-nav__link">
    Passing the Access Token to the CDS Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-service-response" title="CDS Service Response" class="md-nav__link">
    CDS Service Response
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-status-codes_1" title="HTTP Status Codes" class="md-nav__link">
    HTTP Status Codes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-response" title="HTTP Response" class="md-nav__link">
    HTTP Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#card-attributes" title="Card Attributes" class="md-nav__link">
    Card Attributes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source" title="Source" class="md-nav__link">
    Source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggestion" title="Suggestion" class="md-nav__link">
    Suggestion
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action" title="Action" class="md-nav__link">
    Action
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link" title="Link" class="md-nav__link">
    Link
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_1" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-and-safety" title="Security and Safety" class="md-nav__link">
    Security and Safety
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trusting-cds-services" title="Trusting CDS Services" class="md-nav__link">
    Trusting CDS Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trusting-cds-clients" title="Trusting CDS Clients" class="md-nav__link">
    Trusting CDS Clients
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-signing-algorithm" title="JWT Signing Algorithm" class="md-nav__link">
    JWT Signing Algorithm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_2" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-origin-resource-sharing" title="Cross-Origin Resource Sharing" class="md-nav__link">
    Cross-Origin Resource Sharing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensions" title="Extensions" class="md-nav__link">
    Extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" title="Hooks" class="md-nav__link">
    Hooks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_1" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-context-and-prefetch" title="Hook context and prefetch" class="md-nav__link">
    Hook context and prefetch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whats-the-difference" title="What's the difference?" class="md-nav__link">
    What's the difference?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-definition-format" title="Hook Definition Format" class="md-nav__link">
    Hook Definition Format
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hook-name-expressed-as-noun-verb" title="hook-name-expressed-as-noun-verb" class="md-nav__link">
    hook-name-expressed-as-noun-verb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow" title="Workflow" class="md-nav__link">
    Workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context" title="Context" class="md-nav__link">
    Context
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fhir-resources-in-context" title="FHIR resources in context" class="md-nav__link">
    FHIR resources in context
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-maturity-model" title="Hook Maturity Model" class="md-nav__link">
    Hook Maturity Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changes-to-a-hook" title="Changes to a Hook" class="md-nav__link">
    Changes to a Hook
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specification-version" title="Specification Version" class="md-nav__link">
    Specification Version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-version" title="Hook Version" class="md-nav__link">
    Hook Version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-maturity" title="Hook Maturity" class="md-nav__link">
    Hook Maturity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-log" title="Change Log" class="md-nav__link">
    Change Log
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Archived Ballots
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Archived Ballots
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ballots/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ballots/2018May/" title="2018May" class="md-nav__link">
      2018May
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conformance-language" title="Conformance Language" class="md-nav__link">
    Conformance Language
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-hooks-anatomy" title="CDS Hooks Anatomy" class="md-nav__link">
    CDS Hooks Anatomy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discovery" title="Discovery" class="md-nav__link">
    Discovery
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-status-codes" title="HTTP Status Codes" class="md-nav__link">
    HTTP Status Codes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery-example" title="Discovery Example" class="md-nav__link">
    Discovery Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-a-cds-service" title="Calling a CDS Service" class="md-nav__link">
    Calling a CDS Service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request_1" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookinstance" title="hookInstance" class="md-nav__link">
    hookInstance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#providing-fhir-resources-to-a-cds-service" title="Providing FHIR Resources to a CDS Service" class="md-nav__link">
    Providing FHIR Resources to a CDS Service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefetch-template" title="Prefetch Template" class="md-nav__link">
    Prefetch Template
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefetch-tokens" title="Prefetch tokens" class="md-nav__link">
    Prefetch tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefetch-query-restrictions" title="Prefetch query restrictions" class="md-nav__link">
    Prefetch query restrictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-token" title="Example prefetch token" class="md-nav__link">
    Example prefetch token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-templates" title="Example prefetch templates" class="md-nav__link">
    Example prefetch templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-data" title="Example prefetch data" class="md-nav__link">
    Example prefetch data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fhir-resource-access" title="FHIR Resource Access" class="md-nav__link">
    FHIR Resource Access
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passing-the-access-token-to-the-cds-service" title="Passing the Access Token to the CDS Service" class="md-nav__link">
    Passing the Access Token to the CDS Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-service-response" title="CDS Service Response" class="md-nav__link">
    CDS Service Response
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-status-codes_1" title="HTTP Status Codes" class="md-nav__link">
    HTTP Status Codes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-response" title="HTTP Response" class="md-nav__link">
    HTTP Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#card-attributes" title="Card Attributes" class="md-nav__link">
    Card Attributes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source" title="Source" class="md-nav__link">
    Source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggestion" title="Suggestion" class="md-nav__link">
    Suggestion
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action" title="Action" class="md-nav__link">
    Action
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link" title="Link" class="md-nav__link">
    Link
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_1" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-and-safety" title="Security and Safety" class="md-nav__link">
    Security and Safety
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trusting-cds-services" title="Trusting CDS Services" class="md-nav__link">
    Trusting CDS Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trusting-cds-clients" title="Trusting CDS Clients" class="md-nav__link">
    Trusting CDS Clients
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-signing-algorithm" title="JWT Signing Algorithm" class="md-nav__link">
    JWT Signing Algorithm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_2" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-origin-resource-sharing" title="Cross-Origin Resource Sharing" class="md-nav__link">
    Cross-Origin Resource Sharing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensions" title="Extensions" class="md-nav__link">
    Extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" title="Hooks" class="md-nav__link">
    Hooks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_1" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-context-and-prefetch" title="Hook context and prefetch" class="md-nav__link">
    Hook context and prefetch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whats-the-difference" title="What's the difference?" class="md-nav__link">
    What's the difference?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-definition-format" title="Hook Definition Format" class="md-nav__link">
    Hook Definition Format
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hook-name-expressed-as-noun-verb" title="hook-name-expressed-as-noun-verb" class="md-nav__link">
    hook-name-expressed-as-noun-verb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow" title="Workflow" class="md-nav__link">
    Workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context" title="Context" class="md-nav__link">
    Context
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fhir-resources-in-context" title="FHIR resources in context" class="md-nav__link">
    FHIR resources in context
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-maturity-model" title="Hook Maturity Model" class="md-nav__link">
    Hook Maturity Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changes-to-a-hook" title="Changes to a Hook" class="md-nav__link">
    Changes to a Hook
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specification-version" title="Specification Version" class="md-nav__link">
    Specification Version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-version" title="Hook Version" class="md-nav__link">
    Hook Version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hook-maturity" title="Hook Maturity" class="md-nav__link">
    Hook Maturity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-log" title="Change Log" class="md-nav__link">
    Change Log
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/hl7/cds-hooks-hl7-site/edit/master/docs/1.0/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="cds-services">CDS Services</h1>
<div class="admonition info">
<p class="admonition-title">1.0 Release</p>
<p>This is the 1.0 release of the CDS Hooks specification. All releases are available at <a href="https://cds-hooks.hl7.org">https://cds-hooks.hl7.org</a>.</p>
</div>
<h2 id="overview">Overview</h2>
<p>The CDS Hooks specification describes the RESTful APIs and interactions to integrate Clinical Decision Support (CDS) between CDS Clients (typically Electronic Health Record Systems (EHRs) or other health information systems) and CDS Services. All data exchanged through the RESTful APIs MUST be sent and received as <a href="https://tools.ietf.org/html/rfc8259">JSON</a> structures, and MUST be transmitted over channels secured using the Hypertext Transfer Protocol (HTTP) over Transport Layer Security (TLS), also known as HTTPS and defined in <a href="https://tools.ietf.org/html/rfc2818">RFC2818</a>.</p>
<p>Unless otherwise specified, JSON attributes SHALL NOT be null. If a JSON attribute is defined with an optionality of OPTIONAL, but does not have a value, implementers MUST omit it. For instance, OPTIONAL JSON string and array attributes should be omitted rather than having a null or empty value. Similarly, JSON objects SHALL NOT be empty.</p>
<p>Unless otherwise specified, JSON string or URL attributes that have an optionality of REQUIRED MAY NOT have empty values (those without any characters or just whitespace characters).</p>
<h3 id="conformance-language">Conformance Language</h3>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this specification are to be interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC2119</a>.</p>
<h2 id="cds-hooks-anatomy">CDS Hooks Anatomy</h2>
<p>This specification describes a <a href="http://en.wikipedia.org/wiki/Hooking">"hook"</a>-based pattern for invoking
decision support from within a clinician's workflow. The API supports:</p>
<ul>
<li>Synchronous, workflow-triggered CDS calls returning information and suggestions</li>
<li>Launching a user-facing SMART app when CDS requires additional interaction</li>
</ul>
<p>The basic components of CDS Hooks are:</p>
<ul>
<li><strong>CDS Service</strong> A decision support service that accepts requests containing patient information, and provides responses</li>
<li><strong>CDS Client</strong> or <em>EHR</em> An electronic health record, or other clinical information system that consumes decision support in the form of services MAY provide an authorization and FHIR resource server</li>
<li><strong>Hook</strong> A defined point within the client system's workflow with well-known contextual information provided as part of the request</li>
<li><strong>Card</strong> Guidance from decision support services is returned in the form of cards representing discrete recommendations or suggestions that are presented to the user within the CDS Client</li>
</ul>
<p>In CDS Hooks, a <em>CDS Service</em> is a service that provides patient-specific recommendations and guidance through RESTful APIs as described by this specification. The primary APIs are <a href="#discovery">Discovery</a>, which allows a CDS Developer to publish the types of CDS Services it provides, and the <a href="#calling-a-cds-service">Service</a> endpoint that CDS Clients use to request decision support.</p>
<p>A <em>CDS Client</em> is an electronic health record, or other clinical information system that consumes decision support by calling CDS Services at specific points in the application's workflow called <a href="#hooks">hooks</a>. Each hook defines the <em>hook context</em>, contextual information available within the client and specific to the workflow. Each service advertises which hooks it supports and what <a href="#providing-fhir-resources-to-a-cds-service"><em>prefetch data</em></a> (information needed by the CDS Service to determine what decision support should be presented) it requires.</p>
<p>Decision support is then returned to the CDS Client in the form of <a href="#cds-service-response">cards</a>, which the client MAY display to the end-user as part of their workflow. Cards may be informational, or they may provide suggestions that the user may accept or reject, or they may provide a <a href="#link">link</a> to additional information or even launch a SMART app when additional user interaction is required.</p>
<h2 id="discovery">Discovery</h2>
<p>Developers of CDS Services SHALL provide a stable endpoint for allowing CDS Clients to discover available CDS Services, including information such as a description of the CDS Service, when it should be invoked, and any data that is requested to be prefetched.</p>
<p>A CDS Service provider SHALL expose its Discovery endpoint at"</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">{</span>baseURL<span class="o">}</span>/cds-services
</pre></div>
</td></tr></table>

<h3 id="http-request">HTTP Request</h3>
<p>The discovery endpoint SHALL always be available at <code>{baseUrl}/cds-services</code>. For example, if the <code>baseUrl</code> is https://example.com, the CDS Client MAY invoke:</p>
<p><code>GET https://example.com/cds-services</code></p>
<h3 id="response">Response</h3>
<p>The response to the discovery endpoint SHALL be an object containing a list of CDS Services.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>services</code></td>
<td><em>array</em>. An array of <strong>CDS Services</strong>.</td>
</tr>
</tbody>
</table>
<p>Each CDS Service SHALL be described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hook</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The hook this service should be invoked on. See <a href="#hooks">Hooks</a>.</td>
</tr>
<tr>
<td><code>title</code></td>
<td>RECOMMENDED</td>
<td><em>string</em></td>
<td>The human-friendly name of this service.</td>
</tr>
<tr>
<td><nobr><code>description</code></nobr></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The description of this service.</td>
</tr>
<tr>
<td><code>id</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The {id} portion of the URL to this service which is available at<br /><code>{baseUrl}/cds-services/{id}</code></td>
</tr>
<tr>
<td><code>prefetch</code></td>
<td>OPTIONAL</td>
<td><em>object</em></td>
<td>An object containing key/value pairs of FHIR queries that this service is requesting that the CDS Client prefetch and provide on each service call. The key is a <em>string</em> that describes the type of data being requested and the value is a <em>string</em> representing the FHIR query.<br />See <a href="#prefetch-template">Prefetch Template</a>.</td>
</tr>
</tbody>
</table>
<h3 id="http-status-codes">HTTP Status Codes</h3>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>200 OK</code></td>
<td>A successful response.</td>
</tr>
</tbody>
</table>
<p>CDS Services MAY return other HTTP statuses, specifically 4xx and 5xx HTTP error codes.</p>
<h3 id="discovery-example">Discovery Example</h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl <span class="s2">&quot;https://example.com/cds-services&quot;</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;services&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;hook&quot;</span><span class="p">:</span> <span class="s2">&quot;patient-view&quot;</span><span class="p">,</span>
      <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Static CDS Service Example&quot;</span><span class="p">,</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;An example of a CDS Service that returns a static set of cards&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;static-patient-greeter&quot;</span><span class="p">,</span>
      <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;patientToGreet&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{context.patientId}}&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;hook&quot;</span><span class="p">:</span> <span class="s2">&quot;medication-prescribe&quot;</span><span class="p">,</span>
      <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Medication Echo CDS Service&quot;</span><span class="p">,</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;An example of a CDS Service that simply echos the medication being prescribed&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;medication-echo&quot;</span><span class="p">,</span>
      <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;patient&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{context.patientId}}&quot;</span><span class="p">,</span>
        <span class="nt">&quot;medications&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicationRequest?patient={{context.patientId}}&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="calling-a-cds-service">Calling a CDS Service</h2>
<h3 id="http-request_1">HTTP Request</h3>
<p>A CDS Client SHALL call a CDS Service by <code>POST</code>ing a JSON document to the service as described in this section. The CDS Service endpoint can be constructed from the CDS Service base URL and an individual service id as <code>{baseUrl}/cds-services/{service.id}</code>. The request SHALL include a JSON <code>POST</code> body with the following input fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hook</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The hook that triggered this CDS Service call. See <a href="#hooks">Hooks</a>.</td>
</tr>
<tr>
<td><nobr><code>hookInstance</code></nobr></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>A UUID for this particular hook call (see more information below).</td>
</tr>
<tr>
<td><code>fhirServer</code></td>
<td>OPTIONAL</td>
<td><em>URL</em></td>
<td>The base URL of the CDS Client's <a href="https://www.hl7.org/fhir/">FHIR</a> server. If fhirAuthorization is provided, this field is REQUIRED.  The scheme should be <code>https</code></td>
</tr>
<tr>
<td><code>fhirAuthorization</code></td>
<td>OPTIONAL</td>
<td><em>object</em></td>
<td>A structure holding an <a href="https://oauth.net/2/">OAuth 2.0</a> bearer access token granting the CDS Service access to FHIR resources, along with supplemental information relating to the token. See the <a href="#fhir-resource-access">FHIR Resource Access</a> section for more information.</td>
</tr>
<tr>
<td><code>context</code></td>
<td>REQUIRED</td>
<td><em>object</em></td>
<td>Hook-specific contextual data that the CDS service will need.<br />For example, with the <code>patient-view</code> hook this will include the FHIR identifier of the <a href="https://www.hl7.org/fhir/patient.html">Patient</a> being viewed.  For details, see the Hooks specification page.</td>
</tr>
<tr>
<td><code>prefetch</code></td>
<td>OPTIONAL</td>
<td><em>object</em></td>
<td>The FHIR data that was prefetched by the CDS Client (see more information below).</td>
</tr>
</tbody>
</table>
<h4 id="hookinstance">hookInstance</h4>
<p>While working in the CDS Client, a user can perform multiple actions in series or in parallel. For example, a clinician might prescribe two drugs in a row; each prescription action would be assigned a unique <code>hookInstance</code>. This allows a CDS Service to uniquely identify each hook invocation.</p>
<p>Note: the <code>hookInstance</code> is globally unique and should contain enough entropy to be un-guessable.</p>
<h3 id="example">Example</h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl
  -X POST \
  -H &#39;Content-type: application/json&#39; \
  --data @hook-details-see-example-below
  &quot;https://example.com/cds-services/static-patient-greeter&quot;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;hookInstance&quot;</span> <span class="p">:</span> <span class="s2">&quot;d1577c69-dfbe-44ad-ba6d-3e05e953b2ea&quot;</span><span class="p">,</span>
   <span class="nt">&quot;fhirServer&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://hooks.smarthealthit.org:9080&quot;</span><span class="p">,</span>
   <span class="nt">&quot;hook&quot;</span> <span class="p">:</span> <span class="s2">&quot;patient-view&quot;</span><span class="p">,</span>
   <span class="nt">&quot;fhirAuthorization&quot;</span> <span class="p">:</span> <span class="p">{</span>
     <span class="nt">&quot;access_token&quot;</span> <span class="p">:</span> <span class="s2">&quot;some-opaque-fhir-access-token&quot;</span><span class="p">,</span>
     <span class="nt">&quot;token_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
     <span class="nt">&quot;expires_in&quot;</span> <span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
     <span class="nt">&quot;scope&quot;</span> <span class="p">:</span> <span class="s2">&quot;patient/Patient.read patient/Observation.read&quot;</span><span class="p">,</span>
     <span class="nt">&quot;subject&quot;</span> <span class="p">:</span> <span class="s2">&quot;cds-service4&quot;</span>
   <span class="p">},</span>
   <span class="nt">&quot;context&quot;</span> <span class="p">:</span> <span class="p">{</span>
       <span class="nt">&quot;userId&quot;</span> <span class="p">:</span> <span class="s2">&quot;Practitioner/example&quot;</span><span class="p">,</span>
       <span class="nt">&quot;patientId&quot;</span> <span class="p">:</span> <span class="s2">&quot;1288992&quot;</span><span class="p">,</span>
       <span class="nt">&quot;encounterId&quot;</span> <span class="p">:</span> <span class="s2">&quot;89284&quot;</span>
   <span class="p">},</span>
   <span class="nt">&quot;prefetch&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;patientToGreet&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="nt">&quot;resourceType&quot;</span> <span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
         <span class="nt">&quot;gender&quot;</span> <span class="p">:</span> <span class="s2">&quot;male&quot;</span><span class="p">,</span>
         <span class="nt">&quot;birthDate&quot;</span> <span class="p">:</span> <span class="s2">&quot;1925-12-23&quot;</span><span class="p">,</span>
         <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;1288992&quot;</span><span class="p">,</span>
         <span class="nt">&quot;active&quot;</span> <span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="providing-fhir-resources-to-a-cds-service">Providing FHIR Resources to a CDS Service</h2>
<p>Each CDS Service will require specific FHIR resources in order to compute the recommendations the CDS Client requests. If real-world performance were no issue, an CDS Client could launch a CDS Service passing only context data (such as the current user and patient ids), and the CDS Service could then request authorization for FHIR resources as they were needed, and then retrieve the resources from the CDS Client's FHIR server.  Given that CDS Services SHOULD respond quickly (on the order of 500 ms.), this specification defines a process to allow a CDS Service to request and obtain FHIR resources efficiently.</p>
<p>Two optional methods are provided.  First, FHIR resources MAY be obtained by passing "prefetched" data from the CDS Client to the CDS Service in the service call.  FHIR resources requested in the CDS Service description are passed as key-value pairs, with each key matching a key described in the CDS Service description, and each value being a FHIR resource. Note that in the case of searches, this resource may be a <a href="http://hl7.org/fhir/bundle.html#searchset"><code>searchset</code></a> Bundle. If data are to be prefetched, the CDS Service registers a set of "prefetch templates" with the CDS Client, as described in the <a href="#prefetch-template">Prefetch Template</a> section below.</p>
<p>The second method enables the CDS Service to retrieve FHIR resources for itself, but to do so more efficiently than if it were required to request and obtain its own authorization.  If the CDS Client decides to have the CDS Service fetch its own FHIR resources, the CDS Client obtains and passes directly to the CDS Service a bearer token issued for the CDS Service's use in executing FHIR API calls against the CDS Client's FHIR server to obtain the required resources.  Some CDS Clients MAY pass prefetched data, along with a bearer token for the CDS Service to use if additional resources are required.  Each CDS Client SHOULD decide which approach, or combination, is preferred, based on performance considerations and assessment of attendant security and safety risks. For more detail, see the <a href="#fhir-resource-access">FHIR Resource Access</a> section below.</p>
<p>Similarly, each CDS Client will decide what FHIR resources to authorize and to prefetch, based on the CDS Service description's "prefetch" request and on the provider's assessment of the "minimum necessary."  The CDS Client provider and the CDS Service provider will negotiate the set of FHIR resources to be provided, and how these data will be provided, as part of their service agreement.</p>
<h3 id="prefetch-template">Prefetch Template</h3>
<p>A <em>prefetch template</em> is a FHIR <a href="http://hl7.org/fhir/http.html#read"><code>read</code></a> or <a href="http://hl7.org/fhir/http.html#search"><code>search</code></a> request that describes relevant data needed by the CDS Service. For example, the following is a prefetch template for hemoglobin A1c observations:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Observation?patient={{context.patientId}}&amp;code=4548-4&amp;_count=1&amp;sort:desc=date
</pre></div>
</td></tr></table>

<p>To allow for prefetch templates that are dependent on the workflow context, prefetch templates may include references to context using <a href="#prefetch-tokens"><em>prefetch tokens</em></a>. In the above example, <code>{{context.patientId}}</code> is a prefetch token.</p>
<p>The <code>prefetch</code> field of a CDS Service description defines the set of prefetch templates for that service, providing a <em>prefetch key</em> for each one that is used to identify the prefetch data in the CDS request. For example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;hemoglobin-a1c&quot;</span><span class="p">:</span> <span class="s2">&quot;Observation?patient={{context.patientId}}&amp;code=4548-4&amp;_count=1&amp;sort:desc=date&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>In this <code>prefetch</code>, <code>hemoglobin-a1c</code> is the prefetch key for this prefetch template. For a complete worked example, see <a href="#example-prefetch-templates">below</a>.</p>
<p>A CDS Client MAY choose to honor some or all of the desired prefetch templates, and is free to choose the most appropriate source for these data. For example:</p>
<ul>
<li>The CDS Client MAY have some of the desired prefetched data already in memory, thereby removing the need for any network call</li>
<li>The CDS Client MAY compute an efficient set of prefetch templates from multiple CDS Services, thereby reducing the number of calls to a minimum</li>
<li>The CDS Client MAY satisfy some of the desired prefetched templates via some internal service or even its own FHIR server.</li>
</ul>
<p>The CDS Client SHALL deny access to the requested resource if it is outside the user's authorized scope.</p>
<p>As part of preparing the request, a CDS Client processes each prefetch template it intends to satisfy by replacing the prefetch tokens in the prefetch template to construct a relative FHIR request URL. This specification is not prescriptive about how this request is actually processed. The relative URL may be appended to the base URL for the CDS Client's FHIR server and directly invoked, or the CDS Client may use internal infrastructure to satisfy the request in the same way that invoking against the FHIR server would.</p>
<p>Regardless of how the CDS Client satisfies the prefetch templates (if at all), the prefetched data given to the CDS Service MUST be equivalent to the data the CDS Service would receive if it were making its own call to the CDS Client's FHIR server using the parameterized prefetch template.</p>
<blockquote>
<p>Note that this means that CDS services will receive only the information they have requested and are authorized to receive. Prefetch data for other services registered to the same hook MUST NOT be provided. In other words, services SHALL only receive the data they requested in their prefetch and for which they are authorized recipients.</p>
</blockquote>
<p>The resulting response, which MUST be rendered in a single page — no "next page" links allowed — is passed along to the CDS Service using the <code>prefetch</code> parameter (see <a href="#example-prefetch-templates">below</a> for a complete example).</p>
<blockquote>
<p>Note that the reason prefetch results are not allowed to include next page links is that if the prefetched data contains just a single page of data, the CDS Service has no means to retrieve the subsequent pages of data. Consider, for example, a CDS Hooks implementation that does not expose a FHIR server.</p>
</blockquote>
<p>The CDS Client MUST NOT send any prefetch template key that it chooses not to satisfy. Similarly, if the CDS Client encounters an error while prefetching any data, the prefetch template key MUST NOT be sent to the CDS Service. If the CDS Client has no data to populate a template prefetch key, the prefetch template key MUST have a value of <strong>null</strong>. Note that the <strong>null</strong> result is used rather than a bundle with zero entries to account for the possibility that the prefetch url is a single-resource request.</p>
<p>It is the CDS Service's responsibility to check prefetched data against its template to determine what requests were satisfied (if any) and to manually retrieve any additional necessary data. If the CDS Service is unable to obtain required data because it cannot access the FHIR server and the request did not contain the necessary prefetch keys, the service SHALL respond with an HTTP 412 Precondition Failed status code.</p>
<h4 id="prefetch-tokens">Prefetch tokens</h4>
<p>A prefetch token is a placeholder in a prefetch template that is replaced by a value from the hook's context to construct the FHIR URL used to request the prefetch data. </p>
<p>Prefetch tokens MUST be delimited by <code>{{</code> and <code>}}</code>, and MUST contain only the qualified path to a hook context field.</p>
<p>Individual hooks specify which of their <code>context</code> fields can be used as prefetch tokens. Only root-level fields with a primitive value within the <code>context</code> object are eligible to be used as prefetch tokens. For example, <code>{{context.medication.id}}</code> is not a valid prefetch token because it attempts to access the <code>id</code> field of the <code>medication</code> field.</p>
<h4 id="prefetch-query-restrictions">Prefetch query restrictions</h4>
<p>To reduce the implementation burden on CDS Clients that support CDS Services, this specification RECOMMENDS that prefetch queries only use a subset of the full functionality available in the FHIR specification. Valid prefetch templates SHOULD only make use of:</p>
<ul>
<li><em>instance</em> level <a href="https://www.hl7.org/fhir/http.html#read">read</a> interactions (for resources with known ids such as <code>Patient</code> and <code>Practitioner</code>)</li>
<li><em>type</em> level <a href="https://www.hl7.org/fhir/http.html#search">search</a> interactions</li>
<li>Patient references (e.g. <code>patient={{context.patientId}}</code>)</li>
<li><em>token</em> search parameters using equality (e.g. <code>code=4548-4</code>) and optionally the <code>:in</code> modifier (no other modifiers for token parameters)</li>
<li><em>date</em> search parameters on <code>date</code>, <code>dateTime</code>, <code>instant</code>, or <code>Period</code> types only, and using only the prefixes <code>eq</code>, <code>lt</code>, <code>gt</code>, <code>ge</code>, <code>le</code></li>
<li>the <code>_count</code> parameter to limit the number of results returned</li>
<li>the <code>_sort</code> parameter to allow for <em>most recent</em> and <em>first</em> queries</li>
</ul>
<h4 id="example-prefetch-token">Example prefetch token</h4>
<p>Often a prefetch template builds on the contextual data associated with the hook. For example, a particular CDS Service might recommend guidance based on a patient's conditions when the chart is opened. The FHIR query to retrieve these conditions might be <code>Condition?patient=123</code>. In order to express this as a prefetch template, the CDS Service must express the FHIR identifier of the patient as a token so that the CDS Client can replace the token with the appropriate value. When context fields are used as tokens, their token name MUST be <code>context.name-of-the-field</code>. For example, given a context like:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;context&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;patientId&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The token name would be <code>{{context.patientId}}</code>. Again using our above conditions example, the complete prefetch template would be <code>Condition?patient={{context.patientId}}</code>.</p>
<p>Only the first level fields in context may be considered for tokens. Hook creators MUST document which fields in the context are supported as tokens. If a context field can be tokenized, the value of the context field MUST be a JSON primitive data type that can placed into a FHIR query (i.e. a string, a number, or a boolean).</p>
<p>For example, given the following context that contains amongst other things, a Patient FHIR resource:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;context&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;encounterId&quot;</span><span class="p">:</span> <span class="s2">&quot;456&quot;</span><span class="p">,</span>
  <span class="nt">&quot;patient&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span>
    <span class="nt">&quot;active&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;official&quot;</span><span class="p">,</span>
        <span class="nt">&quot;family&quot;</span><span class="p">:</span> <span class="s2">&quot;Watts&quot;</span><span class="p">,</span>
        <span class="nt">&quot;given&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;Wade&quot;</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;gender&quot;</span><span class="p">:</span> <span class="s2">&quot;male&quot;</span><span class="p">,</span>
    <span class="nt">&quot;birthDate&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-12&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Only the <code>encounterId</code> field in this example is eligible to be a prefetch token as it is a first level field and the datatype (string) can be placed into the FHIR query. The Patient.id value in the context is not eligible to be a prefetch token because it is not a first level field. If the hook creator intends for the Patient.id value to be available as a prefetch token, it must be made available as a first level field. Using the aforementioned example, we simply add a new <code>patientId</code> field:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;context&quot;</span> <span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;patientId&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span>
  <span class="nt">&quot;encounterId&quot;</span><span class="p">:</span> <span class="s2">&quot;456&quot;</span><span class="p">,</span>
  <span class="nt">&quot;patient&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span>
    <span class="nt">&quot;active&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;official&quot;</span><span class="p">,</span>
        <span class="nt">&quot;family&quot;</span><span class="p">:</span> <span class="s2">&quot;Watts&quot;</span><span class="p">,</span>
        <span class="nt">&quot;given&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;Wade&quot;</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;gender&quot;</span><span class="p">:</span> <span class="s2">&quot;male&quot;</span><span class="p">,</span>
    <span class="nt">&quot;birthDate&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-12&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h4 id="example-prefetch-templates">Example prefetch templates</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;patient&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{context.patientId}}&quot;</span><span class="p">,</span>
    <span class="nt">&quot;hemoglobin-a1c&quot;</span><span class="p">:</span> <span class="s2">&quot;Observation?patient={{context.patientId}}&amp;code=4548-4&amp;_count=1&amp;sort:desc=date&quot;</span><span class="p">,</span>
    <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;{{context.userId}}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Here is an example prefetch field from a CDS Service discovery endpoint. The
goal is to know, at call time:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>patient</code></td>
<td>Patient demographics.</td>
</tr>
<tr>
<td><code>hemoglobin-a1c</code></td>
<td>Most recent Hemoglobin A1c reading for this patient.</td>
</tr>
<tr>
<td><code>user</code></td>
<td>Information on the current user (Practitioner).</td>
</tr>
</tbody>
</table>
<h4 id="example-prefetch-data">Example prefetch data</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;patient&quot;</span><span class="p">:{</span>
      <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
      <span class="nt">&quot;gender&quot;</span><span class="p">:</span> <span class="s2">&quot;male&quot;</span><span class="p">,</span>
      <span class="nt">&quot;birthDate&quot;</span><span class="p">:</span> <span class="s2">&quot;1974-12-25&quot;</span><span class="p">,</span>
      <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;snipped for brevity&gt;&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;hemoglobin-a1c&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Bundle&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;searchset&quot;</span><span class="p">,</span>
      <span class="nt">&quot;entry&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Observation&quot;</span><span class="p">,</span>
        <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://loinc.org&quot;</span><span class="p">,</span>
            <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;4548-4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;display&quot;</span><span class="p">:</span> <span class="s2">&quot;Hemoglobin A1c&quot;</span>
            <span class="p">}]</span>
          <span class="p">},</span>
          <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;snipped for brevity&gt;&quot;</span>
        <span class="p">}</span>
      <span class="p">}]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The CDS Hooks request is augmented to include two prefetch values, where the dictionary
keys match the request keys (<code>patient</code> and <code>hemoglobin-a1c</code> in this case).</p>
<p>Note that the missing <code>user</code> key indicates that either the CDS Client has decided not to satisfy this particular prefetch template or it was not able to retrieve this prefetched data. The CDS Service is responsible for retrieving this Practitioner data from the FHIR server (if required).</p>
<h3 id="fhir-resource-access">FHIR Resource Access</h3>
<p>If the CDS Client provides both <code>fhirServer</code> and <code>fhirAuthorization</code> request parameters, the CDS Service MAY use the FHIR server to obtain any FHIR resources it requires beyond those provided by the CDS Client as prefetched data. This is similar to the approach used by SMART on FHIR wherein the SMART app requests and ultimately obtains an access token from the CDS Client's Authorization server using the SMART launch workflow, as described in <a href="http://hl7.org/fhir/smart-app-launch/1.0.0/">SMART App Launch Implementation Guide</a>.</p>
<p>Like SMART on FHIR, CDS Hooks requires that clients present a valid access token to the FHIR server with each API call. Thus, a CDS Service MUST be able to obtain an access token before communicating with the CDS Client's FHIR resource server. While CDS Hooks shares the underlying technical framework and standards as SMART on FHIR, the CDS Hooks workflow MUST accommodate the automated, low-latency delivery of an access token to the CDS service.</p>
<p>With CDS Hooks, if the CDS Client wants to provide the CDS Service direct access to FHIR resources, the CDS Client creates an access token prior to invoking the CDS Service, passing this token to the CDS Service as part of the service call. This approach remains compatible with <a href="https://oauth.net/2/">OAuth 2.0's</a> bearer token protocol while minimizing the number of HTTPS round-trips and the service invocation latency. The CDS Client remains in control of creating an access token that is associated with the specific CDS Service, user, and context of the invocation.  As the CDS Service executes on behalf of a user, the data to which the CDS Service is given access by the CDS Client MUST be limited to the same restrictions and authorizations afforded the current user. As such, the access token SHALL be scoped to:</p>
<ul>
<li>The CDS Service being invoked</li>
<li>The current user</li>
</ul>
<h4 id="passing-the-access-token-to-the-cds-service">Passing the Access Token to the CDS Service</h4>
<p>The access token is specified in the CDS Service request via the <code>fhirAuthorization</code> request parameter. This parameter is an object that contains both the access token as well as other related information as specified below.  If the CDS Client chooses not to pass along an access token, the <code>fhirAuthorization</code> parameter is omitted.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>access_token</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>This is the <a href="https://oauth.net/2/">OAuth 2.0</a> access token that provides access to the FHIR server.</td>
</tr>
<tr>
<td><code>token_type</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>Fixed value: <code>Bearer</code></td>
</tr>
<tr>
<td><code>expires_in</code></td>
<td>REQUIRED</td>
<td><em>integer</em></td>
<td>The lifetime in seconds of the access token.</td>
</tr>
<tr>
<td><code>scope</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The scopes the access token grants the CDS Service.</td>
</tr>
<tr>
<td><code>subject</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The <a href="https://oauth.net/2/">OAuth 2.0</a> client identifier of the CDS Service, as registered with the CDS Client's authorization server.</td>
</tr>
</tbody>
</table>
<p>The scopes granted to the CDS Service via the <code>scope</code> field are defined by the <a href="http://hl7.org/fhir/smart-app-launch/1.0.0/scopes-and-launch-context/">SMART on FHIR specification</a>.</p>
<p>The <code>expires_in</code> value is established by the authorization server and SHOULD BE very short lived, as the access token MUST be treated as a transient value by the CDS Service.</p>
<p>Below is an example <code>fhirAuthorization</code> parameter:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;fhirAuthorization&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;access_token&quot;</span> <span class="p">:</span> <span class="s2">&quot;some-opaque-fhir-access-token&quot;</span><span class="p">,</span>
    <span class="nt">&quot;token_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
    <span class="nt">&quot;expires_in&quot;</span> <span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="nt">&quot;scope&quot;</span> <span class="p">:</span> <span class="s2">&quot;patient/Patient.read patient/Observation.read&quot;</span><span class="p">,</span>
    <span class="nt">&quot;subject&quot;</span> <span class="p">:</span> <span class="s2">&quot;cds-service4&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="cds-service-response">CDS Service Response</h2>
<p>For successful responses, CDS Services SHALL respond with a 200 HTTP response with an object containing a <code>cards</code> element as described below.</p>
<p>Each card contains decision support from the CDS Service. Generally speaking, cards are intended for display to an end user. The data format of a card defines a very minimal set of required attributes with several more optional attributes to suit a variety of use cases. For instance, narrative informational decision support, actionable suggestions to modify data, and links to SMART apps.</p>
<blockquote>
<p>Note that because the CDS client may be invoking multiple services from the same hook, there may be multiple responses related to the same information. This specification does not address these scenarios specifically; both CDS Services and CDS Clients should consider the implications of multiple CDS Services in their integrations.</p>
</blockquote>
<h3 id="http-status-codes_1">HTTP Status Codes</h3>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>200 OK</code></td>
<td>A successful response.</td>
</tr>
<tr>
<td><code>412 Precondition Failed</code></td>
<td>The CDS Service is unable to retrieve the necessary FHIR data to execute its decision support, either through a prefetch request or directly calling the FHIR server.</td>
</tr>
</tbody>
</table>
<p>CDS Services MAY return other HTTP statuses, specifically 4xx and 5xx HTTP error codes.</p>
<h3 id="http-response">HTTP Response</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cards</code></td>
<td>REQUIRED</td>
<td><em>array</em></td>
<td>An array of <strong>Cards</strong>. Cards can provide a combination of information (for reading), suggested actions (to be applied if a user selects them), and links (to launch an app if the user selects them). The CDS Client decides how to display cards, but this specification recommends displaying suggestions using buttons, and links using underlined text.</td>
</tr>
</tbody>
</table>
<p>If your CDS Service has no decision support for the user, your service should return a 200 HTTP response with an empty array of cards.</p>
<blockquote>
<p>Response when no decision support is necessary for the user</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="card-attributes">Card Attributes</h3>
<p>Each <strong>Card</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>summary</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>One-sentence, &lt;140-character summary message for display to the user inside of this card.</td>
</tr>
<tr>
<td><code>detail</code></td>
<td>OPTIONAL</td>
<td><em>string</em></td>
<td>Optional detailed information to display; if provided MUST be represented in <a href="https://github.github.com/gfm/">(GitHub Flavored) Markdown</a>. (For non-urgent cards, the CDS Client MAY hide these details until the user clicks a link like "view more details...").</td>
</tr>
<tr>
<td><code>indicator</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>Urgency/importance of what this card conveys. Allowed values, in order of increasing urgency, are: <code>info</code>, <code>warning</code>, <code>critical</code>. The CDS Client MAY use this field to help make UI display decisions such as sort order or coloring.</td>
</tr>
<tr>
<td><code>source</code></td>
<td>REQUIRED</td>
<td><em>object</em></td>
<td>Grouping structure for the <strong>Source</strong> of the information displayed on this card. The source should be the primary source of guidance for the decision support the card represents.</td>
</tr>
<tr>
<td><nobr><code>suggestions</code></nobr></td>
<td>OPTIONAL</td>
<td><em>array</em> of <strong>Suggestions</strong></td>
<td>Allows a service to suggest a set of changes in the context of the current activity (e.g.  changing the dose of the medication currently being prescribed, for the <code>medication-prescribe</code> activity). If suggestions are present, <code>selectionBehavior</code> MUST also be provided.</td>
</tr>
<tr>
<td><code>selectionBehavior</code></td>
<td>OPTIONAL</td>
<td><em>string</em></td>
<td>Describes the intended selection behavior of the suggestions in the card. Currently, the only allowed value is <code>at-most-one</code>, indicating that the user may choose none or at most one of the suggestions. Future versions of the specification may expand this behavior, so CDS Clients that do not understand the value MUST treat the card as an error. CDS Clients MUST support the value of <code>at-most-one</code>.</td>
</tr>
<tr>
<td><code>links</code></td>
<td>OPTIONAL</td>
<td><em>array</em> of <strong>Links</strong></td>
<td>Allows a service to suggest a link to an app that the user might want to run for additional information or to help guide a decision.</td>
</tr>
</tbody>
</table>
<h4 id="source">Source</h4>
<p>The <strong>Source</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><nobr><code>label</code></nobr></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>A short, human-readable label to display for the source of the information displayed on this card. If a <code>url</code> is also specified, this MAY be the text for the hyperlink.</td>
</tr>
<tr>
<td><code>url</code></td>
<td>OPTIONAL</td>
<td><em>URL</em></td>
<td>An optional absolute URL to load (via <code>GET</code>, in a browser context) when a user clicks on this link to learn more about the organization or data set that provided the information on this card. Note that this URL should not be used to supply a context-specific "drill-down" view of the information on this card. For that, use <code>link.url</code> instead.</td>
</tr>
<tr>
<td><code>icon</code></td>
<td>OPTIONAL</td>
<td><em>URL</em></td>
<td>An absolute URL to an icon for the source of this card. The icon returned by this URL SHOULD be a 100x100 pixel PNG image without any transparent regions.</td>
</tr>
</tbody>
</table>
<h4 id="suggestion">Suggestion</h4>
<p>Each <strong>Suggestion</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>label</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>Human-readable label to display for this suggestion (e.g. the CDS Client might render this as the text on a button tied to this suggestion).</td>
</tr>
<tr>
<td><code>uuid</code></td>
<td>OPTIONAL</td>
<td><em>string</em></td>
<td>Unique identifier, used for auditing and logging suggestions.</td>
</tr>
<tr>
<td><code>actions</code></td>
<td>OPTIONAL</td>
<td><em>array</em></td>
<td>Array of objects, each defining a suggested action. Within a suggestion, all actions are logically AND'd together, such that a user selecting a suggestion selects all of the actions within it.</td>
</tr>
</tbody>
</table>
<h5 id="action">Action</h5>
<p>Each <strong>Action</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The type of action being performed. Allowed values are: <code>create</code>, <code>update</code>, <code>delete</code>.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>Human-readable description of the suggested action MAY be presented to the end-user.</td>
</tr>
<tr>
<td><code>resource</code></td>
<td>OPTIONAL</td>
<td><em>object</em></td>
<td>Depending upon the <code>type</code> attribute, a new resource or the id of a resource. When the <code>type</code> attribute is <code>create</code>, the <code>resource</code> attribute SHALL contain a new FHIR resource to be created. For <code>delete</code>, this SHALL be the id of the resource to remove. In hooks where only one "content" resource is ever relevant, this attribute MAY be omitted for <code>delete</code> action types only. For <code>update</code>, this holds the updated resource in its entirety and not just the changed fields.</td>
</tr>
</tbody>
</table>
<p>The following example illustrates a create action:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Create a prescription for Acetaminophen 250 MG&quot;</span><span class="p">,</span>
    <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicationRequest&quot;</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;medrx001&quot;</span><span class="p">,</span>
        <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;snipped for brevity&gt;&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The following example illustrates an update action:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Update the order to record the appropriateness score&quot;</span><span class="p">,</span>
    <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;ProcedureRequest&quot;</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;procedure-request-1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;snipped for brevity&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The following example illustrates a delete action:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Remove the inappropriate order&quot;</span><span class="p">,</span>
    <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="s2">&quot;ProcedureRequest/procedure-request-1&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h4 id="link">Link</h4>
<p>Each <strong>Link</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><nobr><code>label</code></nobr></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>Human-readable label to display for this link (e.g. the CDS Client might render this as the underlined text of a clickable link).</td>
</tr>
<tr>
<td><code>url</code></td>
<td>REQUIRED</td>
<td><em>URL</em></td>
<td>URL to load (via <code>GET</code>, in a browser context) when a user clicks on this link. Note that this MAY be a "deep link" with context embedded in path segments, query parameters, or a hash.</td>
</tr>
<tr>
<td><code>type</code></td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The type of the given URL. There are two possible values for this field. A type of <code>absolute</code> indicates that the URL is absolute and should be treated as-is. A type of <code>smart</code> indicates that the URL is a SMART app launch URL and the CDS Client should ensure the SMART app launch URL is populated with the appropriate SMART launch parameters.</td>
</tr>
<tr>
<td><code>appContext</code></td>
<td>OPTIONAL</td>
<td><em>string</em></td>
<td>An optional field that allows the CDS Service to share information from the CDS card with a subsequently launched SMART app. The <code>appContext</code> field should only be valued if the link type is <code>smart</code> and is not valid for <code>absolute</code> links. The <code>appContext</code> field and value will be sent to the SMART app as part of the <a href="https://oauth.net/2/">OAuth 2.0</a> access token response, alongside the other <a href="http://hl7.org/fhir/smart-app-launch/1.0.0/scopes-and-launch-context/#launch-context-arrives-with-your-access_token">SMART launch parameters</a> when the SMART app is launched. Note that <code>appContext</code> could be escaped JSON, base64 encoded XML, or even a simple string, so long as the SMART app can recognize it.</td>
</tr>
</tbody>
</table>
<h3 id="example_1">Example</h3>
<blockquote>
<p>Example response</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Example Card&quot;</span><span class="p">,</span>
      <span class="nt">&quot;indicator&quot;</span><span class="p">:</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
      <span class="nt">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;This is an example card.&quot;</span><span class="p">,</span>
      <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Static CDS Service Example&quot;</span><span class="p">,</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
        <span class="nt">&quot;icon&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/img/icon-100px.png&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Google&quot;</span><span class="p">,</span>
          <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://google.com&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;absolute&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Github&quot;</span><span class="p">,</span>
          <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;absolute&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;SMART Example App&quot;</span><span class="p">,</span>
          <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://smart.example.com/launch&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;smart&quot;</span><span class="p">,</span>
          <span class="nt">&quot;appContext&quot;</span><span class="p">:</span> <span class="s2">&quot;{\&quot;session\&quot;:3456356,\&quot;settings\&quot;:{\&quot;module\&quot;:4235}}&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Another card&quot;</span><span class="p">,</span>
      <span class="nt">&quot;indicator&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
      <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Static CDS Service Example&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="security-and-safety">Security and Safety</h2>
<p>Security and safety risks associated with the CDS Hooks API include:</p>
<ol>
<li>The risk that confidential information and privileged authorizations transmitted between a CDS Client and a CDS Service could be surreptitiously intercepted by an attacker;</li>
<li>The risk that an attacker masquerading as a legitimate CDS Service could receive confidential information or privileged authorizations from a CDS Client, or could provide to a CDS Client decision support recommendations that could be harmful to a patient;</li>
<li>The risk that an attacker masquerading as a legitimate service-subscribing CDS Client (i.e., man-in-the-middle) could intercept and possibly alter data exchanged between the two parties.</li>
<li>The risk that a CDS Service could embed dangerous suggestions or links to dangerous apps in Cards returned to a CDS Client.</li>
<li>The risk that a CDS Hooks browser-based deployment could be victimized by a Cross-Origin Resource Sharing (CORS) attack.</li>
<li>The risk that a CDS Service could return a decision based on outdated patient data, resulting in a safety risk to the patient.</li>
</ol>
<p>CDS Hooks defines a security model that addresses these risks by assuring that the identities of both the CDS Service and the CDS Client are authenticated to each other; by protecting confidential information and privileged authorizations shared between a CDS Client and a CDS Service; by recommending means of assuring data freshness; and by incorporating business mechanisms through which trust is established and maintained between a CDS Client and a CDS Service.</p>
<h3 id="trusting-cds-services">Trusting CDS Services</h3>
<p>Prior to enabling CDS Clients to request decision support from any CDS Service, the CDS Client vendor and/or provider organization is expected to perform due diligence on the CDS Service provider.  Each CDS Client vendor/provider is individually responsible for determining the suitability, safety and integrity of the CDS Services it uses, based on the organization's own risk-management strategy.  Each CDS Client vendor/provider SHOULD maintain a "white list" (and/or "black list") of the CDS Services it has vetted, and the Card links that have been deemed safe to display from within the CDS Client context. Each provider organization is expected to work with its CDS Client vendor to choose what CDS Services to allow and to negotiate the conditions under which the CDS Services MAY be called.</p>
<p>Once a CDS Service provider is selected, the CDS Client vendor/provider negotiates the terms under which service will be provided.  This negotiation includes agreement on patient data elements that will be prefetched and provided to the CDS Service, data elements that will be made available through an access token passed by the CDS Client, and steps the CDS Service MUST take to protect patient data and access tokens.  To enable the CDS Client's authorization server to authorize CDS Service access to FHIR resources, the CDS Service is registered as a client to the CDS Client authorization server.  These business arrangements are documented in the service agreement.</p>
<p>Every interaction between an CDS Client and a CDS Service is initiated by the CDS Client sending a service request to a CDS Service endpoint protected using the <a href="https://tools.ietf.org/html/rfc5246">Transport Layer Security protocol</a>. Through the TLS protocol the identity of the CDS Service is authenticated, and an encrypted transmission channel is established between the CDS Client and the CDS Service. Both the Discovery endpoint and individual CDS Service endpoints are TLS secured.</p>
<p>The authorization server is responsible for enforcing restrictions on the CDS Services that MAY be called and the scope of the FHIR resources that MAY be prefetched or retrieved from the FHIR server.  If a CDS Client is satisfying prefetch requests from a CDS Service or sends a non-null <code>fhirAuthorization</code> object to a CDS Service so that it can call the FHIR server, the CDS Service MUST be pre-registered with the authorization server protecting access to the FHIR server.  Pre-registration includes registering a CDS client identifier, and agreeing upon the scope of FHIR access that is minimally necessary to provide the clinical decision support required. This specification does not address how the CDS Client, authorization server, and CDS Service perform this pre-registration.</p>
<h3 id="trusting-cds-clients">Trusting CDS Clients</h3>
<p>The service agreement negotiated between the CDS Client vendor/provider and the CDS Service provider will include obligations the CDS Client vendor/provider commits to the CDS Service provider. Some agreements MAY include the use of mutual TLS, in which both ends of the channel are authenticated.</p>
<p>However, mutual TLS is impractical for many organizations, and because the CDS Client initiates the TLS channel set-up, only the CDS Service endpoint will be authenticated.  To enable the CDS Service to authenticate the identity of the CDS Client, CDS Hooks uses digitally signed <a href="https://jwt.io/">JSON web tokens (JWT)</a> (<a href="https://tools.ietf.org/html/rfc7519">rfc7519</a>).</p>
<p>Each time a CDS Client transmits a request to a CDS Service, the request MUST include an <code>Authorization</code> header presenting the JWT as a “Bearer” token:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Authorization:  Bearer {{JWT}}
</pre></div>
</td></tr></table>

<p>Note that this is for every single CDS Service call, whether that be a Discovery call, a single CDS Service invocation, or multiple exchanges relating to a single service. Also note that mutual TLS MAY be used alongside JSON web tokens to establish trust of the CDS Client by the CDS Service.</p>
<p>The CDS Client MUST use its private key to digitally sign the JWT, using the <a href="https://tools.ietf.org/html/rfc7515">JSON Web Signatures (rfc7515)</a> standard.</p>
<p>The JWT header contains the following fields (see <a href="https://tools.ietf.org/html/rfc7515#section-4.1">rfc7515 section 4.1</a> for further information on these standard headers):</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>alg</td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The cryptographic algorithm used to sign this JWT.</td>
</tr>
<tr>
<td>kid</td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The identifier of the key-pair used to sign this JWT. This identifier MUST be unique within the CDS Client's JWK Set.</td>
</tr>
<tr>
<td>typ</td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>Fixed value: <code>JWT</code></td>
</tr>
<tr>
<td>jku</td>
<td>OPTIONAL</td>
<td><em>url</em></td>
<td>The URL to the JWK Set containing the public key(s).</td>
</tr>
</tbody>
</table>
<p>The JWT payload contains the following fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>iss</td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>The URI of the issuer of this JWT.  Note that the JWT MAY be self-issued by the CDS Client, or MAY be issued by a third-party identity provider.</td>
</tr>
<tr>
<td>aud</td>
<td>REQUIRED</td>
<td><em>string</em> or <em>array of string</em></td>
<td>The CDS Service endpoint that is being called by the CDS Client. (See more details below).</td>
</tr>
<tr>
<td>exp</td>
<td>REQUIRED</td>
<td><em>number</em></td>
<td>Expiration time integer for this authentication JWT, expressed in seconds since the "Epoch" (1970-01-01T00:00:00Z UTC).</td>
</tr>
<tr>
<td>iat</td>
<td>REQUIRED</td>
<td><em>number</em></td>
<td>The time at which this JWT was issued, expressed in seconds since the "Epoch" (1970-01-01T00:00:00Z UTC).</td>
</tr>
<tr>
<td>jti</td>
<td>REQUIRED</td>
<td><em>string</em></td>
<td>A nonce string value that uniquely identifies this authentication JWT (used to protect against replay attacks).</td>
</tr>
<tr>
<td>tenant</td>
<td>OPTIONAL</td>
<td><em>string</em></td>
<td>An opaque string identifying the healthcare organization that is invoking the CDS Hooks request.</td>
</tr>
</tbody>
</table>
<p>CDS Services SHOULD whitelist the <code>iss</code> and <code>jku</code> fields to only the CDS Clients they trust.</p>
<p>Per <a href="https://tools.ietf.org/html/rfc7519#section-4.1.3">rfc7519</a>, the <code>aud</code> value is either a string or an array of strings. For CDS Hooks, this value MUST be the URL of the CDS Service endpoint being invoked. For example, consider a CDS Service available at a base URL of <code>https://cds.example.org</code>. When the CDS Client invokes the CDS Service discovery endpoint, the aud value is either <code>"https://cds.example.org/cds-services"</code> or <code>["https://cds.example.org/cds-services"]</code>. Similarly, when the CDS Client invokes a particular CDS Service (say, <code>some-service</code>), the aud value is either <code>"https://cds.example.org/cds-services/some-service"</code> or <code>["https://cds.example.org/cds-services/some-service"]</code>.</p>
<p>The CDS Client MUST make its public key, expressed as a JSON Web Key (JWK) in a JWK Set, as defined by <a href="https://tools.ietf.org/html/rfc7517">rfc7517</a>. The <code>kid</code> value from the JWT header allows a CDS Service to identify the correct JWK in the JWK Set that can be used to verify the signature.</p>
<p>The CDS Client MAY make its JWK Set available via a URL identified by the <code>jku</code> header field, as defined by <a href="https://tools.ietf.org/html/rfc7515#section-4.1.2">rfc7515 4.1.2</a>. If the <code>jku</code> header field is ommitted, the CDS Client and CDS Service SHALL communicate the JWK Set out-of-band.</p>
<h4 id="jwt-signing-algorithm">JWT Signing Algorithm</h4>
<p>The cryptographic signing algorithm of JWT is indicated in the <code>alg</code> header field. <a href="https://tools.ietf.org/html/rfc7518">JSON Web Algorithms (rfc7518)</a> defines several cryptographic algorithms for use in signing JWTs and should be referenced by CDS Hooks implementers.</p>
<p>JWTs SHALL NOT be signed used the <code>none</code> algorithm, referred to in rfc7518 as unsecured JSON Web Signatures, as the lack of a cryptographic signature does not provide any integrity protection. Such JWTs could not be used by a CDS Service to identity the CDS Client preventing an establishment of trust.</p>
<p>JWTs SHALL NOT be signed using any symmetric algorithm as these algorithms require the CDS Client and CDS Service to share a private key in order to verify the signature. For example, all HMAC based algorithms rely upon a shared private key and thus SHALL NOT be used to sign a JWT.</p>
<p>When choosing an algorithm to sign their JWTs, CDS Clients SHOULD consider not only the algorithms (and key sizes) that are recommended within the security industry, but also how well those algorithms are supported in the various programming languages and libraries that may be used by CDS Services.</p>
<p>At publication time of this specification, both ES384 and RS384 are RECOMMENDED for their regard within the larger security industry, strength, and support across popular programming languages and libraries. However, stronger and better algorithms are continually being introduced due to new threats, weaknesses, and increases in computing power. CDS Clients SHOULD continually re-evaluate their choice of an algorithm based upon these ever changing conditions.</p>
<p>CDS Services SHOULD consider the algorithms they understand and trust based upon their tolerance for risk.</p>
<h4 id="example_2">Example</h4>
<p>An example JSON web token header, payload, and JWK set:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="err">//</span> <span class="err">JSON</span> <span class="err">Web</span> <span class="err">Token</span> <span class="err">Header</span>
<span class="p">{</span>
  <span class="nt">&quot;alg&quot;</span><span class="p">:</span> <span class="s2">&quot;ES384&quot;</span><span class="p">,</span>
  <span class="nt">&quot;typ&quot;</span><span class="p">:</span> <span class="s2">&quot;JWT&quot;</span><span class="p">,</span>
  <span class="nt">&quot;kid&quot;</span><span class="p">:</span> <span class="s2">&quot;example-kid&quot;</span><span class="p">,</span>
  <span class="nt">&quot;jku&quot;</span><span class="p">:</span> <span class="s2">&quot;https://fhir-ehr.example.com/jwk_uri&quot;</span>
<span class="p">}</span>

<span class="err">//</span> <span class="err">JSON</span> <span class="err">Web</span> <span class="err">Token</span> <span class="err">Payload</span>
<span class="p">{</span>
  <span class="nt">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;https://fhir-ehr.example.com/&quot;</span><span class="p">,</span>
  <span class="nt">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;client_id&quot;</span><span class="p">,</span>
  <span class="nt">&quot;aud&quot;</span><span class="p">:</span> <span class="s2">&quot;https://cds.example.org/cds-services/some-service&quot;</span><span class="p">,</span>
  <span class="nt">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">1422568860</span><span class="p">,</span>
  <span class="nt">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1311280970</span><span class="p">,</span>
  <span class="nt">&quot;jti&quot;</span><span class="p">:</span> <span class="s2">&quot;ee22b021-e1b7-4611-ba5b-8eec6a33ac1e&quot;</span><span class="p">,</span>
  <span class="nt">&quot;tenant&quot;</span><span class="p">:</span> <span class="s2">&quot;2ddd6c3a-8e9a-44c6-a305-52111ad302a2&quot;</span>
<span class="p">}</span>

<span class="err">//</span> <span class="err">JSON</span> <span class="err">Web</span> <span class="err">Key</span> <span class="err">Set</span> <span class="err">(public</span> <span class="err">key)</span>
<span class="err">//</span> <span class="err">This</span> <span class="err">public</span> <span class="err">key</span> <span class="err">is</span> <span class="err">used</span> <span class="err">by</span> <span class="err">the</span> <span class="err">CDS</span> <span class="err">Service</span> <span class="err">to</span> <span class="err">verify</span> <span class="err">the</span> <span class="err">signature</span> <span class="err">of</span> <span class="err">the</span> <span class="err">JWT</span>
<span class="p">{</span>  
  <span class="nt">&quot;keys&quot;</span><span class="p">:[</span>  
    <span class="p">{</span>  
      <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
      <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;sig&quot;</span><span class="p">,</span>
      <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;P-384&quot;</span><span class="p">,</span>
      <span class="nt">&quot;kid&quot;</span><span class="p">:</span> <span class="s2">&quot;example-kid&quot;</span><span class="p">,</span>
      <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;46SDH7Znh821wblCBglA61sNE9ZrHYKKt3qRtRTmSXyOI_FIGBLWrWa0GPUkDCEk&quot;</span><span class="p">,</span>
      <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;XMcRuuoGW7CXjQdy-F5i3FeBE0x9hPLdeFdSoDd3ELmx404tLX0VRRcqzAsPhXcI&quot;</span><span class="p">,</span>
      <span class="nt">&quot;alg&quot;</span><span class="p">:</span> <span class="s2">&quot;ES384&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="err">//</span> <span class="err">JSON</span> <span class="err">Web</span> <span class="err">Key</span> <span class="err">(private</span> <span class="err">key)</span>
<span class="err">//</span> <span class="err">This</span> <span class="err">private</span> <span class="err">key</span> <span class="err">is</span> <span class="err">used</span> <span class="err">by</span> <span class="err">the</span> <span class="err">CDS</span> <span class="err">Client</span> <span class="err">to</span> <span class="err">sign</span> <span class="err">the</span> <span class="err">JWT</span>
<span class="p">{</span>  
  <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
  <span class="nt">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;SeFXUXda8UomZ8GFUl7HH_Oi15rIbfMcsWj9ecIsDR8kLbqsEz2CGNgwy_IcILxy&quot;</span><span class="p">,</span>
  <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;sig&quot;</span><span class="p">,</span>
  <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;P-384&quot;</span><span class="p">,</span>
  <span class="nt">&quot;kid&quot;</span><span class="p">:</span> <span class="s2">&quot;example-kid&quot;</span><span class="p">,</span>
  <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;46SDH7Znh821wblCBglA61sNE9ZrHYKKt3qRtRTmSXyOI_FIGBLWrWa0GPUkDCEk&quot;</span><span class="p">,</span>
  <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;XMcRuuoGW7CXjQdy-F5i3FeBE0x9hPLdeFdSoDd3ELmx404tLX0VRRcqzAsPhXcI&quot;</span><span class="p">,</span>
  <span class="nt">&quot;alg&quot;</span><span class="p">:</span> <span class="s2">&quot;ES384&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Using the above JWT values and JWKs, the complete JWT as passed in the Authorization HTTP header would be:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Authorization: Bearer eyJhbGciOiJFUzM4NCIsInR5cCI6IkpXVCIsImtpZCI6ImV4YW1wbGUta2lkIiwiamt1IjoiaHR0cHM6Ly9maGlyLWVoci5leGFtcGxlLmNvbS9qd2tfdXJpIn0.eyJpc3MiOiJodHRwczovL2ZoaXItZWhyLmV4YW1wbGUuY29tLyIsInN1YiI6ImNsaWVudF9pZCIsImF1ZCI6Imh0dHBzOi8vY2RzLmV4YW1wbGUub3JnL2Nkcy1zZXJ2aWNlcy9zb21lLXNlcnZpY2UiLCJleHAiOjE0MjI1Njg4NjAsImlhdCI6MTMxMTI4MDk3MCwianRpIjoiZWUyMmIwMjEtZTFiNy00NjExLWJhNWItOGVlYzZhMzNhYzFlIiwidGVuYW50IjoiMmRkZDZjM2EtOGU5YS00NGM2LWEzMDUtNTIxMTFhZDMwMmEyIn0.CUFPkplnWd6YGIvzoHolWCQBDsCL8QtTWKGg_QFpS169WrqDGzktRi-_we6-6rVzbjerU27ZKww_SW0-b9RTz-dPJNcqsueMio8r6EqXUXhbLm_ch3XFSbDlGHDl_tqo
</pre></div>
</td></tr></table>

<h3 id="cross-origin-resource-sharing">Cross-Origin Resource Sharing</h3>
<p><a href="https://www.w3.org/TR/cors/">Cross-origin resource sharing (CORS)</a> is a W3C standard mechanism that uses additional HTTP headers to enable a web browser to gain permission to access resources from an Internet domain different from that from which the browser is currently accessing.  CORS is a client-side security mechanism with well-documented security risks.</p>
<p>CDS Services and browser-based CDS Clients will require CORS support. A secure implementation guide for CORS is outside of the scope of this CDS Hooks specification. Organizations planning to implement CDS Hooks with CORS support are referred to the Cross-Origin Resource Sharing section of the <a href="https://www.owasp.org/index.php/HTML5_Security_Cheat_Sheet">OWASP HTML5 Security Cheat Sheet</a>.</p>
<h2 id="extensions">Extensions</h2>
<p>The specification is not prescriptive about support for extensions. However, to support extensions, the specification reserves the name <code>extension</code> and will never define an element with that name, allowing implementations to use it to provide custom behavior and information. The value of an extension element MUST be a pre-coordinated JSON object.</p>
<p>For example, an extension on a request could look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;hookInstance&quot;</span> <span class="p">:</span> <span class="s2">&quot;d1577c69-dfbe-44ad-ba6d-3e05e953b2ea&quot;</span><span class="p">,</span>
   <span class="nt">&quot;fhirServer&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://fhir.example.org:9080&quot;</span><span class="p">,</span>
   <span class="nt">&quot;hook&quot;</span> <span class="p">:</span> <span class="s2">&quot;patient-view&quot;</span><span class="p">,</span>
   <span class="nt">&quot;context&quot;</span> <span class="p">:</span> <span class="p">{</span>
       <span class="nt">&quot;userId&quot;</span> <span class="p">:</span> <span class="s2">&quot;Practitioner/example&quot;</span>
   <span class="p">},</span>
   <span class="nt">&quot;extension&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;com.example.timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-11-27T22:13:25Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;myextension-practitionerspecialty&quot;</span> <span class="p">:</span> <span class="s2">&quot;gastroenterology&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>As another example, an extension defined on the discovery response could look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;services&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Example CDS Service Discovery&quot;</span><span class="p">,</span>
      <span class="nt">&quot;hook&quot;</span><span class="p">:</span> <span class="s2">&quot;patient-view&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;patientview&quot;</span><span class="p">,</span>
      <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;patient&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{context.patientId}}&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;clinical decision support for patient view&quot;</span><span class="p">,</span>
      <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;example-client-conformance&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hooks.example.org/fhir/102/Conformance/patientview&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="hooks">Hooks</h2>
<h3 id="overview_1">Overview</h3>
<p>As a specification, CDS Hooks does not prescribe a default or required set of hooks for implementers. Rather, the set of hooks defined here are merely a set of common use cases that were used to aid in the creation of CDS Hooks. The set of hooks defined here are not a closed set; anyone is able to define new hooks to fit their use cases and propose those hooks to the community. New hooks are proposed in a prescribed <a href="#hook-definition-format">format</a> using the <a href="../hooks/template">documentation template</a> by submitting a <a href="https://github.com/cds-hooks/docs/tree/master/docs/hooks">pull request</a>. Hooks are <a href="#changes-to-the-definition-of-a-hook-hook-versioning">versioned</a>, and mature according to the <a href="#hook-maturity-model">Hook Maturity Model</a>. </p>
<p>Note that each hook (e.g. <code>medication-prescribe</code>) represents something the user is doing in the CDS Client and multiple CDS Services might respond to the same hook (e.g. a "price check" service and a "prior authorization" service might both respond to <code>medication-prescribe</code>).</p>
<h3 id="hook-context-and-prefetch">Hook context and prefetch</h3>
<h4 id="whats-the-difference">What's the difference?</h4>
<p>Any user workflow or action within a CDS Client will naturally include contextual information such as the current user and patient. CDS Hooks refers to this information as <em>context</em> and allows each hook to define the information that is available in the context. Because CDS Hooks is intended to support usage within any CDS Client, this context can contain both required and optional data, depending on the capabilities of individual CDS Clients. However, the context information is intended to be relevant to most CDS Services subscribing to the hook.</p>
<p>For example, consider a simple <code>patient-view</code> hook that is invoked whenever the user views a patient's information within the CDS Client. At this point in the workflow, the contextual information would include at least the current user and the patient that is being viewed. The hook declares this as <code>context</code>, and passes it to the CDS Service as part of the request in the <code>context</code> field:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;context&quot;</span><span class="err">:</span><span class="p">{</span>
  <span class="nt">&quot;userId&quot;</span> <span class="p">:</span> <span class="s2">&quot;Practitioner/123&quot;</span><span class="p">,</span>
  <span class="nt">&quot;patientId&quot;</span> <span class="p">:</span> <span class="s2">&quot;1288992&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Prefetch data, on the other hand, is defined by CDS Services as a way to allow the CDS Client to provide the data that a CDS Service needs as part of the initial request to the service. When the context data relates to a FHIR resource, it is important not to conflate context and prefetch. For instance, in the hook described above for opening a patient's chart, the hook includes the id of the patient whose chart is being opened, not the full patient FHIR resource. In this case, the FHIR identifier of the patient is appropriate as CDS Services may not be interested in details about the patient resource but instead other data related to this patient. Or, a CDS Service may only need the full patient resource in certain scenarios. Therefore, including the full patient resource in context would be unnecessary. For CDS Services that want the full patient resource, they can request it to be prefetched or fetch it as needed from the FHIR server using a prefetch template in their discovery response, such as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;prefetch&quot;</span><span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;patientToGreet&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{context.patientId}}&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>See the section on <a href="#prefetch-tokens">prefetch tokens</a> for more information on how contextual information can be used to parameterize prefetch templates.</p>
<p>Consider another hook for when a new patient is being registered. In this case, it would likely be appropriate for the context to contain the full FHIR resource for the patient being registered as the patient may not be yet recorded in the CDS Client (and thus not available from the FHIR server) and CDS Services using this hook would predominantly be interested in the details of the patient being registered.</p>
<p>Additionally, consider a PGX CDS Service and a Zika screening CDS Service, each of which is subscribed to the same hook. The context data specified by their shared hook should contain data relevant to both CDS Services; however, each service will have other specific data needs that will necessitate disparate prefetch requests. For instance, the PGX CDS Service likely is interested in genomics data whereas the Zika screening CDS Service will want Observations.</p>
<p>In summary, context is specified in the hook definition to guide developers on the information available at the point in the workflow when the hook is triggered. Prefetch data is defined by each CDS Service because it is specific to the information that service needs in order to process.</p>
<h3 id="hook-definition-format">Hook Definition Format</h3>
<p>Hooks are defined in the following format.</p>
<h4 id="hook-name-expressed-as-noun-verb"><code>hook-name-expressed-as-noun-verb</code></h4>
<p>The name of the hook SHOULD succinctly and clearly describe the activity or event. Hook names are unique so hook creators SHOULD take care to ensure newly proposed hooks do not conflict with an existing hook name. Hook creators SHALL name their hook with reverse domain notation (e.g. <code>org.example.patient-transmogrify</code>) if the hook is specific to an organization. Reverse domain notation SHALL not be used by a standard hooks catalog.</p>
<p>When naming hooks, the name should start with the subject (noun) of the hook and be followed by the activity (verb). For example, <code>patient-view</code> (not <code>view-patient</code>) or <code>medication-prescribe</code> (not <code>prescribe-medication</code>).</p>
<h4 id="workflow">Workflow</h4>
<p>Describe when this hook occurs in a workflow. Hook creators SHOULD include as much detail and clarity as possible to minimize any ambiguity or confusion amongst implementors.</p>
<h3 id="context">Context</h3>
<p>Describe the set of contextual data used by this hook. Only data logically and necessarily associated with the purpose of this hook should be represented in context.</p>
<p>All fields defined by the hook's context MUST be defined in a table where each field is described by the following attributes:</p>
<ul>
<li>Field: The name of the field in the context JSON object. Hook authors SHOULD name their context fields to be consistent with other existing hooks when referring to the same context field.</li>
<li>Optionality: A string value of either <code>REQUIRED</code> or <code>OPTIONAL</code></li>
<li>Prefetch Token: A string value of either <code>Yes</code> or <code>No</code>, indicating whether this field can be tokenized in a prefetch template.</li>
<li>Type: The type of the field in the context JSON object, expressed as the JSON type, or the name of a FHIR Resource type. Valid types are <em>boolean</em>, <em>string</em>, <em>number</em>, <em>object</em>, <em>array</em>, or the name of a FHIR resource type. When a field can be of multiple types, type names MUST be separated by a <em>pipe</em> (<code>|</code>)</li>
<li>Description: A functional description of the context value. If this value can change according to the FHIR version in use, the description SHOULD describe the value for each supported FHIR version.</li>
</ul>
<p>The table below illustrates a sample hook context table:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Prefetch Token</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>someField</code></td>
<td>REQUIRED</td>
<td>Yes</td>
<td><em>string</em></td>
<td>A clear description of the value of this field.</td>
</tr>
<tr>
<td><code>anotherField</code></td>
<td>OPTIONAL</td>
<td>No</td>
<td><em>number</em></td>
<td>A clear description of the value of this field.</td>
</tr>
<tr>
<td><code>someObject</code></td>
<td>REQUIRED</td>
<td>No</td>
<td><em>object</em></td>
<td>A clear description of the value of this field.</td>
</tr>
<tr>
<td><code>moreObjects</code></td>
<td>OPTIONAL</td>
<td>No</td>
<td><em>array</em></td>
<td>A clear description of the items in this array.</td>
</tr>
<tr>
<td><code>allFHIR</code></td>
<td>OPTIONAL</td>
<td>No</td>
<td><em>object</em></td>
<td>A FHIR Bundle of the following FHIR resources using a specific version of FHIR.</td>
</tr>
</tbody>
</table>
<h4 id="fhir-resources-in-context">FHIR resources in context</h4>
<p>For context fields that may contain multiple FHIR resources, the field SHOULD be defined as a FHIR Bundle, rather than as an array of FHIR resources. For example, multiple FHIR resources are necessary to describe all of the orders under review in the <code>order-review</code> hook's <code>orders</code> field. Hook definitions SHOULD prefer the use of FHIR Bundles over other bespoke data structures.</p>
<p>Often, context is populated with in-progress or in-memory data that may not yet be available from the FHIR server. For example, imagine a hook, <code>medication-order</code> that is invoked when a user selects a medication durating an order workflow. The context data for this hook would contain draft FHIR resources representing the medications that have been selected for ordering. In this case, the CDS Client should only provide these draft resources and not the full set of orders available from its FHIR server. The CDS service MAY pre-fetch or query for FHIR resources with other statuses. </p>
<p>All FHIR resources in context MUST be based on the same FHIR version. </p>
<h4 id="examples">Examples</h4>
<p>Hook creators SHOULD include examples of the context.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;context&quot;</span><span class="err">:</span><span class="p">{</span>
  <span class="nt">&quot;someField&quot;</span><span class="p">:</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="nt">&quot;anotherField&quot;</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span>
  <span class="nt">&quot;someObject&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="nt">&quot;moreObjects&quot;</span><span class="p">:[]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>If the context contains FHIR data, hook creators SHOULD include examples across multiple versions of FHIR if differences across FHIR versions are possible.</p>
<h3 id="hook-maturity-model">Hook Maturity Model</h3>
<p>The intent of the CDS Hooks Maturity Model is to attain broad community engagement and consensus, before a hook is labeled as mature, that the hook is necessary, implementable, and worthwhile to the CDS services and CDS clients that would reasonably be expected to use it. Implementer feedback should drive the maturity of new hooks. Diverse participation in open developer forums and events, such as HL7 FHIR Connectathons, is necessary to achieve significant implementer feedback. The below criteria will be evaluated with these goals in mind. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Hook maturity | 3 - Considered
</pre></div>
</td></tr></table>

<p>The Hook maturity levels use the term CDS client to generically refer to the clinical workflow system in which a CDS services returned cards are displayed. </p>
<table>
<thead>
<tr>
<th>Maturity Level</th>
<th>Maturity title</th>
<th>Requirements</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Draft</td>
<td>Hook is defined according to the <a href="#hook-definition-format">hook definition format</a>.</td>
</tr>
<tr>
<td>1</td>
<td>Submitted</td>
<td><em>The above, and …</em> Hook definition is written up as a <a href="https://github.com/cds-hooks/docs/tree/master/docs/hooks">github pull request</a> using the <a href="hooks/template/">Hook template</a> and community feedback is solicited on the <a href="https://chat.fhir.org/#narrow/stream/17-cds-hooks">zulip CDS Hooks stream</a>.</td>
</tr>
<tr>
<td>2</td>
<td>Tested</td>
<td><em>The above, and …</em> The hook has been tested and successfully supports interoperability among at least one CDS client and two independent CDS services using semi-realistic data and scenarios (e.g. at a FHIR Connectathon). The github pull request defining the hook is approved and published by the CDS Hooks Project Management Committee.</td>
</tr>
<tr>
<td>3</td>
<td>Considered</td>
<td><em>The above, and …</em> At least 3 distinct organizations recorded ten distinct implementer comments (including a github issue, tracker item, or comment on the hook definition page), including at least two CDS clients and three independent CDS services. The hook has been tested at two connectathons.</td>
</tr>
<tr>
<td>4</td>
<td>Documented</td>
<td><em>The above, and …</em> The author agrees that the artifact is sufficiently stable to require implementer consultation for subsequent non-backward compatible changes.  The hook is implemented in the standard CDS Hooks sandbox and multiple prototype projects. The Hook specification SHALL: <ul><ol>Identify a broad set of example contexts in which the hook may be used with a minimum of three, but as many as 8-10.</ol><ol>Clearly differentiate the hook from similar hooks or other standards to help an implementer determine if the hook is correct for their scenario.</ol><ol>Explicitly document example scenarios when the hook should not be used.</ol></ul></td>
</tr>
<tr>
<td>5</td>
<td>Mature</td>
<td><em>The above, and ...</em> The hook has been implemented in production in at least two CDS clients and three independent CDS services. An HL7 working group ballots the hook and the hook has passed HL7 STU ballot.</td>
</tr>
<tr>
<td>6</td>
<td>Normative</td>
<td><em>The above, and ...</em> the responsible HL7 working group and the CDS working group agree the material is ready to lock down and the hook has passed HL7 normative ballot</td>
</tr>
</tbody>
</table>
<h3 id="changes-to-a-hook">Changes to a Hook</h3>
<p>Each hook MUST include a Metadata table at the beginning of the hook with the specification version and hook version as described in the following sections.</p>
<h4 id="specification-version">Specification Version</h4>
<p>Because hooks are such an integral part of the CDS Hooks specification, hook definitions are associated with specific versions of the specification. The hook definition MUST include the version (or versions) of the CDS Hooks specification that it is defined to work with.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>specificationVersion | 1.0
</pre></div>
</td></tr></table>

<p>Because the specification itself follows semantic versioning, the version specified here is a minimum specification version. In other words, a hook defined to work against 1.0 should continue to work against the 1.1 version of CDS Hooks. However, a hook that specifies 1.1 would not be expected to work in a CDS Hooks 1.0 environment.</p>
<h4 id="hook-version">Hook Version</h4>
<p>To enable tracking of changes to hook definitions, each hook MUST include a version indicator, expressed as a string.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>hookVersion | 1.0
</pre></div>
</td></tr></table>

<p>To help ensure the stability of CDS Hooks implementations, once a hook has been defined (i.e. published with a particular name so that it is available for implementation), breaking changes MUST NOT be made. This means that fields can be added and restrictions relaxed, but fields cannot be changed, and restrictions cannot be tightened.</p>
<p>In particular, the semantics of a hook (i.e. the meaning of the hook from the perspective of the CDS Client) cannot be changed. CDS Clients that implement specific hooks are responsible for ensuring the hook is called from the appropriate point in the workflow.</p>
<p>Note that this means that the name of the hook carries major version semantics. That is not to say that the name must include the major version, that is left as a choice to authors of the specification. For example, following version 1.x, the major version MAY be included in the name as "-2", "-3", etc. Eg: patient-view-2, patient-view-3, etc. Clean hook names increase usability. Ideally, an active hook name accurately defines the meaning and workflow of the hook in actual words.</p>
<p>The following types of changes are possible for a hook definition:</p>
<table>
<thead>
<tr>
<th>Change</th>
<th>Version Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>Clarifications and corrections to documentation that do not impact functionality</td>
<td>Patch</td>
</tr>
<tr>
<td>Change of prefetch token status of an existing context field</td>
<td>Major</td>
</tr>
<tr>
<td>Addition of a new, REQUIRED field to the context</td>
<td>Major</td>
</tr>
<tr>
<td>Addition of a new, OPTIONAL field to the context</td>
<td>Minor</td>
</tr>
<tr>
<td>Change of optionality of an existing context field</td>
<td>Major</td>
</tr>
<tr>
<td>Change of type or cardinality of an existing context field</td>
<td>Major</td>
</tr>
<tr>
<td>Removal of an existing context field</td>
<td>Major</td>
</tr>
<tr>
<td>Change of semantics of an existing context field</td>
<td>Major</td>
</tr>
<tr>
<td>Change of semantics of the hook</td>
<td>Major</td>
</tr>
</tbody>
</table>
<p>When a major change is made, the hook definition MUST be published under a new name. When a minor or patch change is made, the hook version MUST be updated. Hook definers MUST use <a href="https://semver.org/">semantic versioning</a> to communicate the impact of changes in an industry standard way.</p>
<blockquote>
<p>Note that the intent of this table is to outline possible breaking changes. The authors have attempted to enumerate these types of changes exhaustively, but as new types of breaking changes are identified, this list will be updated.</p>
</blockquote>
<h4 id="hook-maturity">Hook Maturity</h4>
<p>As each hook progresses through a process of being defined, tested, implemented, used in production environments, and balloted, the hook's formal maturity level increases. Each hook has its own maturity level, which MUST be defined in the hook's definition and correspond to the <a href="#hook-maturity-model">Hook Maturity Model</a>. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>hookMaturity | 0 - Draft
</pre></div>
</td></tr></table>

<h4 id="change-log">Change Log</h4>
<p>Changes made to a hook's definition MUST be documented in a change log to ensure hook consumers can track what has been changed over the life of a hook. The change log MUST contain the following elements:</p>
<ul>
<li>Version: The version of the change</li>
<li>Description: A description of the change and its impact</li>
</ul>
<p>For example:</p>
<table>
<thead>
<tr>
<th>Version</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>Added new context variable</td>
</tr>
<tr>
<td>1.0.1</td>
<td>Clarified context variable usage</td>
</tr>
<tr>
<td>1.0</td>
<td>Initial Release</td>
</tr>
</tbody>
</table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../ballots/" title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Home
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            © 2019 HL7 & Boston Children's Hospital.<p></p> <img alt="HL7 International" src="/images/hl7-logo.png" /><p></p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/cds-hooks" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.267712eb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>